CPDUP(1)                  BSD General Commands Manual                 CPDUP(1)

NNAAMMEE
     ccppdduupp — mirror filesystems

SSYYNNOOPPSSIISS
     ccppdduupp [--CC] [--vv[vv[vv]]] [--dd] [--uu] [--II] [--ff] [--FF _s_s_h_-_a_r_g] [--ss00] [--ii00] [--jj00]
           [--ll] [--qq] [--oo] [--mm] [--HH _p_a_t_h] [--MM _f_i_l_e] [--VV] [--VVVV] [--SS] [--RR] [--kk]
           [--KK _f_i_l_e] [--XX _f_i_l_e] [--xx] [[_u_s_e_r@]_h_o_s_t:]_s_o_u_r_c_e___d_i_r
           [[_u_s_e_r@]_h_o_s_t:]_t_a_r_g_e_t___d_i_r

DDEESSCCRRIIPPTTIIOONN
     The ccppdduupp utility makes an exact mirror copy of the source in the desti‐
     nation, creating and deleting files and directories as necessary.
     UTimes, hardlinks, softlinks, devices, permissions, and flags are mir‐
     rored.  By default, ccppdduupp asks for confirmation if any file or directory
     needs to be removed from the destination and does not copy files which it
     believes to have already been synchronized (by observing that the source
     and destination files' sizes and mtimes match).  ccppdduupp does not cross
     mount points in either the source or the destination.  As a safety mea‐
     sure, ccppdduupp refuses to replace a destination directory with a file.

     The following options are available:

     --CC    If the source or target is a remote host, request that the ssh(1)
           session be compressed.  This is the same as --FF --CC.

     --vv[vv[vv]]
           Set verboseness.  By default ccppdduupp does not report its progress
           except when asking for confirmation.  A single --vv will only report
           modifications made to the destination.  --vvvv will report directories
           as they are being traversed as well as modifications made to the
           destination.  --vvvvvv will cause all files and directories to be
           reported whether or not modifications are made.

     --dd    Print directories as they are being traversed.  Useful to watch the
           progress; this typically produces much less output than --vvvv.

     --uu    Causes the output generated by --vv and --dd to be unbuffered.  This
           can be useful for obtaining prompt progress updates through a pipe.

     --II    will cause ccppdduupp to print a summary at the end with performance
           counters.

     --ff    Forces file updates to occur even if the files appear to be the
           same.  If the --HH option is used, this option will force a byte for
           byte comparison between the original file and the file in the
           hardlink path, even if all the stat info matches, but will still
           use a hardlink if they match.

     --FF _s_s_h_-_a_r_g
           Pass _s_s_h_-_a_r_g to ssh.  For example “--FF --pp222222”.  Note the lack of a
           space.

     --ss00   Disable the disallow-file-replaces-directory safety feature.  This
           safety feature is enabled by default to prevent user mistakes from
           blowing away everything accidentally.

     --ii00   Do not request confirmation when removing something.

     --jj00   Do not try to recreate CHR or BLK devices.

     --ll    Line buffer verbose output.

     --qq    Quiet operation.

     --oo    Do not remove any files, just overwrite/add.

     --mm    Generate and maintain a MD5 checkfile called _._M_D_5_._C_H_E_C_K_S_U_M_S in each
           directory on the source and do an MD5 check on each file of the
           destination when the destination appears to be the same as the
           source.  If the check fails, the source is recopied to the destina‐
           tion.  When you specify a destination directory, the MD5 checkfile
           is only updated as needed and may not be updated even if modifica‐
           tions are made to a source file.  If you do not specify a destina‐
           tion directory the ccppdduupp command forcefully regenerates the MD5
           checkfile for every file in the source.

     --MM _f_i_l_e
           Works the same as --mm but allows you to specify the name of the MD5
           checkfile.

     --HH _p_a_t_h
           ccppdduupp will create a hardlink from a file found under _p_a_t_h to the
           target instead of copying the source to the target if the file
           found via _p_a_t_h is identical to the source.  Note that a remote host
           specification should not be used for this option's _p_a_t_h, but the
           _p_a_t_h will be relative to the target machine.

           This allows one to use ccppdduupp to create incremental backups of a
           filesystem.  Create a direct ‘level 0’ backup, and then specify the
           level 0 backup path with this option when creating an incremental
           backup to a different target directory.  This method works so long
           as the filesystem does not hit a hardlink limit.  If the system
           does hit a hardlink limit, ccppdduupp will generate a warning and copy
           the file instead.  Note that ccppdduupp must record file paths for any
           hardlinked file while operating and therefore uses a great deal
           more memory when dealing with hardlinks or hardlink-based backups.
           Example use:

                 cpdup -i0 -s0 -I -H /backup/home.l0 /home /backup/home.l1

           WARNING: If this option is used ccppdduupp must record the paths for all
           files it encounters while it operates and it is possible that you
           may run the process out of memory.

           The file found via the hardlink path will be byte-by-byte compared
           with the source if the --VV or --ff option is also used, otherwise only
           the stat info is checked to determine whether it matches the
           source.

     --VV    This forces the contents of regular files to be verified, even if
           the files appear to the be the same.  Whereas the --ff (force) option
           forces a copy regardless, this option will avoid rewriting the tar‐
           get if everything matches and the contents are verified to be the
           same.

     --VVVV   This works the same as --VV but ignores mtime entirely, making it
           suitable for comparing HAMMER master and slave filesystems or
           copies made without mtime retention.

     --SS    This places ccppdduupp into slave mode and is used to initiate the slave
           protocol on a remote machine.  This option is not intended to be
           used by humans.

     --RR    Place the slave into read-only mode.  Can only be used when the
           source is remote.  Useful for unattended backups via SSH keys.

     --kk    Generate and maintain a FSMID checkfile called  _._F_S_M_I_D_._C_H_E_C_K in
           each directory on the target.  ccppdduupp will check the FSMID for each
           source file or directory against the checkfile on the target and
           will not copy the file or recurse through the directory when a
           match occurs.  Any source file or directory with the same name as
           the checkfile will be ignored.  The FSMID will be re-checked after
           the copy has been completed and ccppdduupp will loop on that directory
           or file until it is sure it has an exact copy.

           Warning: FSMID is not always supported by a filesystem and may not
           be synchronized if a crash occurs.  DragonFly will simulate an
           FSMID when it is otherwise not supported by the filesystem, and
           users should be aware that simulated FSMIDs may change state in
           such cases even if the underlying hierarchy does not due to cache
           flushes.  Additionally, the FSMID may not reflect changes made to
           remote filesystems by other hosts.  For example, using these
           options with NFS mounted sources will not work well.

     --KK _f_i_l_e
           Works the same as --kk but allows you to specify the name of the
           FSMID checkfile.

     --xx    Causes ccppdduupp to use the exclusion file _._c_p_i_g_n_o_r_e in each directory
           on the source to determine which files to ignore.  When this option
           is used, the exclusion filename itself is automatically excluded
           from the copy.  If this option is not used then the filename
           _._c_p_i_g_n_o_r_e is not considered special and will be copied along with
           everything else.

     --XX _f_i_l_e
           Works the same as --xx but allows you to specify the name of the
           exclusion file.  This file is automatically excluded from the copy.
           Only one exclusion file may be specified.

RREEMMOOTTEE CCOOPPYYIINNGG
     ccppdduupp can mirror directory structures across machines and can also do
     third-party copies.  This also works between machines that use different
     byte order.  ssh(1) sessions are used and ccppdduupp is run on the remote
     machine(s) in slave mode.  You can use the --FF option to pass additional
     flags to the ssh command if necessary.

     The syntax of remote path specifications is similar to scp(1).  In par‐
     ticular, that means that a local path containing a colon must be preceded
     by a slash to prevent it being considered a remote host: ‘foo:bar’ causes
     ccppdduupp to look for a directory called ‘bar’ on host ‘foo’, while
     ‘./foo:bar’ denotes the directory ‘foo:bar’ on the local machine.

DDIIAAGGNNOOSSTTIICCSS
     The ccppdduupp utility exits 0 if no error occurred and >0 if an error
     occurred.

SSEEEE AALLSSOO
     cp(1), cpio(1), scp(1), ssh(1), tar(1)

HHIISSTTOORRYY
     The ccppdduupp command was originally created to update servers at BEST Inter‐
     net circa 1997 and was placed under the FreeBSD copyright for inclusion
     in the ports area in 1999.  The program was written by Matthew Dillon,
     Dima Ruban, and later significantly improved by Oliver Fromme.

BBUUGGSS
     UFS(5) has a hardlink limit of 32767.  Many programs, in particular CVS
     with regards to its CVS/Root file, will generate a lot of hard links.
     When using the --HH option it may not be possible for ccppdduupp to maintain
     these hard links.  If this occurs, ccppdduupp will be forced to copy the file
     instead of link it, and thus not be able to make a perfect copy of the
     filesystem.

     When so-called sparse files (i.e. files with "holes") are copied, the
     holes will be filled in the target files, so they occupy more physical
     disk space than the source files.

     For compatibility reasons, the slave protocol is not as efficient for
     writing remote files as it is for reading them.  Therefore it is recom‐
     mended to run ccppdduupp on the target machine when making remote copies, so
     the source machine is remote.  If you do it the other way, ccppdduupp will run
     somewhat slower.

BSD                            November 24, 2009                           BSD
